---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

generators:
# Uncomment for SiteConfig CR creation
- siteconfig.yaml

resources:
 - github.com/redhat-partner-solutions/vse-ocp-bases/base/ztp/site-config?ref=main
patches:
 - target:
    kind: Secret
   patch: |-
     - op: replace
       path: /metadata/name
       value: '{{ cluster_name }}-bmc-creds-secret'
     - op: replace
       path: /metadata/namespace
       value: '{{ cluster_name }}'
     - op: replace
       path: /data/username
       value: '{{ username | b64encode  }}'
     - op: replace
       path: /data/password
       value: '{{ password | b64encode  }}'
 - target:
    kind: SealedSecret
   patch: |-
     - op: replace
       path: /metadata/name
       value: 'assisted-deployment-pull-secret'
     - op: replace
       path: /metadata/namespace
       value: '{{ cluster_name }}'
     - op: replace
       path: /spec/encryptedData/.dockerconfigjson
       value: '{{ pull_secret_encrypted.stdout }}'
     - op: replace
       path: /spec/encryptedData/type
     - op: replace
       path: /spec/template/metadata/name
       value: '{{ cluster_name }}-bmc-creds-secret'
     - op: replace
       path: /spec/template/metadata/namespace
       value: '{{ cluster_name }}'
